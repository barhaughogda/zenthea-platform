# Slice 06: Clinical Note Signing Semantics â€” Definition

## 1. Purpose
This slice formalizes the semantics of "signing" a clinical note within the Zenthea Platform. It defines signing as an explicit, irreversible transition from a mutable state to an immutable, finalized state. This definition establishes the invariants required for non-repudiation and regulatory compliance.

## 2. Scope
This is a **DESIGN-ONLY, NON-EXECUTABLE** specification. It defines the logical constraints and state transition rules for clinical note signing.

### 2.1 Inclusions
- Definition of signing as an explicit, irreversible act.
- Separation of authorship from signature authority (capability-based).
- Requirement for explicit signing intent.
- Definition of a deterministic signing timestamp authority.
- Enforcement of idempotency and replay safety.
- Establishment of the non-repudiation invariant.
- Restriction of signing operations to notes in `DRAFT` state only.

### 2.2 Exclusions (Mandatory)
- No cryptographic implementation details (algorithms, providers).
- No key management or certificate handling.
- No User Interface (UI) flows or presentation logic.
- No workflow engines or orchestration frameworks.
- No background jobs or asynchronous processing.
- No administrative overrides or "backdoor" signing.
- No "undo", "revoke", or "supersede" semantics.

## 3. Core Invariants

### 3.1 Irreversibility
Once a signature is applied to a clinical note, the transition is permanent. The system MUST NOT provide any mechanism to revert a signed note to a `DRAFT` or mutable state.

### 3.2 Immutability Post-Signature
A signed clinical note is immutable. The system MUST forbid any modification to the note's content, metadata, or signature after the signing event has occurred.

### 3.3 State Gating
Signing is only permitted if the clinical note is in the `DRAFT` state. Any attempt to sign a note in any other state (e.g., `SIGNED`, `DELETED`, `ARCHIVED`) MUST be rejected.

### 3.4 Non-Repudiation
The signing event MUST capture sufficient evidence to establish that a specific capability-holder performed the signing action with explicit intent at a specific point in time.

### 3.5 Deterministic Timestamping
The signature timestamp MUST be generated by the system's authoritative clock at the moment of execution. The system MUST NOT accept client-provided timestamps for the signing event.

### 3.6 Idempotency
An attempt to sign a note that is already signed MUST NOT result in a new signature or a change in state. The operation MUST return the existing signed state or a deterministic error indicating the note is already signed.

## 4. Prohibitions

- **NO Unsigned Final States**: A clinical note cannot reach a "final" or "locked" state without a valid signature.
- **NO Post-Sign Edits**: No edits, additions, or deletions are permitted to the clinical note content after signing.
- **NO Reversals**: There is no "unsign" operation.
- **NO Overrides**: No user, regardless of capability level, can override the immutability of a signed note.

## 5. Capability-Based Authority
Authority to sign is defined by the possession of a specific "signing capability" rather than a fixed user role.
- **Authorship != Signature Authority**: Being the author of a note does not inherently grant the capability to sign it.
- **Explicit Intent**: The signing action requires a distinct command that expresses the intent to sign, separate from a "save" or "update" command.

## 6. Phase Boundary
This slice concludes with the formalization of these semantics. Implementation of the transport, authorization, and persistence layers to enforce these invariants will be handled in subsequent execution slices.
